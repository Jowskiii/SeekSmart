<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEEKSMART</title>
    <link rel="icon" type="image/x-icon" href="images\favicon.ico">
    <link rel="stylesheet" href="css/addloststud.css">
</head>
<body>
<div class="sidebar">
  <div class="profile">
    <img src="images/picon.png" alt="Profile Icon">
    <h2>Student</h2>
  </div>
  <a href="lostitemstud.html">Search Lost Items</a>
  <a href="addloststud.html">Add Lost Items</a>
  <a href="claimstud.html">Claimed Items</a>
  <a href="settings.html">Change Password</a>
  <a href="index.html">Log Out</a>
</div>
<div class="content">
  <div class="content-header">
    <h1>Add Lost Item</h1>
    <img src="images/hccslogo.png" class="logo" alt="Logo">
  </div>
</div>
<div class="container">
    <div class="box">
        <form id="lostItemForm">
            <label for="image">Add Image:</label><br>
            <input type="file" id="image" name="image" autocomplete = "off"><br><br>
            <label for="founderName">Founder Name:</label><br>
            <input type="text" id="founderName" name="founderName" autocomplete = "off"><br>
            <label for="itemName">Item Name:</label><br>
            <input type="text" id="itemName" name="itemName" autocomplete = "off"><br>
            <label for="itemDescription">Item Description:</label><br>
            <textarea id="itemDescription" name="itemDescription" autocomplete = "off"></textarea><br>
            <label for="foundDate">Found Date:</label><br>
            <input type="date" id="foundDate" name="foundDate" autocomplete = "off"><br>
            <label for="foundLocation">Found Location:</label><br>
            <input type="text" id="foundLocation" name="foundLocation" autocomplete = "off"><br>
            <label for="keywordDescription">Keyword Description:</label><br>
            <input type="text" id="keywordDescription" name="keywordDescription" autocomplete = "off"><br><br>
            <input type="submit" value="Submit" id="submitButton">
        </form>
        <div id="notification" class="notification">Item added successfully!</div>
    </div>
</div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
  import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "seeksmart-database.firebaseapp.com",
    databaseURL: "https://seeksmart-database-default-rtdb.firebaseio.com",
    projectId: "seeksmart-database",
    storageBucket: "seeksmart-database.appspot.com",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const storage = getStorage(app);

  let isSubmitting = false;

  // Form submission handler
  document.getElementById('lostItemForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    if (isSubmitting) return;
    isSubmitting = true;

    const submitButton = document.getElementById('submitButton');
    submitButton.disabled = true;

    const founderName = document.getElementById('founderName').value;
    const itemName = document.getElementById('itemName').value;
    const itemDescription = document.getElementById('itemDescription').value;
    const foundDate = document.getElementById('foundDate').value;
    const foundLocation = document.getElementById('foundLocation').value;
    const keywordDescription = document.getElementById('keywordDescription').value;
    const imageFile = document.getElementById('image').files[0];

    const notification = document.getElementById('notification');

    try {
      if (imageFile) {
        const storageReference = storageRef(storage, `images/${imageFile.name}`);
        await uploadBytes(storageReference, imageFile);
        const photoURL = await getDownloadURL(storageReference);

        const newItemRef = ref(db, 'lostItemForm/' + Date.now());
        await set(newItemRef, {
          founderName,
          itemName,
          itemDescription,
          foundDate,
          foundLocation,
          keywordDescription,
          photo: photoURL,
          returned: false
        });

        notification.textContent = "Item added successfully!";
        notification.classList.add('success');
        notification.style.display = 'block';
        setTimeout(() => {
          notification.style.display = 'none';
        }, 3000);

        // Clear form fields after submission
        document.getElementById('lostItemForm').reset();
      }
    } catch (error) {
      notification.textContent = "Error adding item: " + error.message;
      notification.classList.add('error');
      notification.style.display = 'block';
      console.error("Error adding item: ", error);
    } finally {
      submitButton.disabled = false;
      isSubmitting = false;
    }
  });
</script>

</body>
</html>
