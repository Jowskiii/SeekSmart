<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEEKSMART</title>
  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/dbadminstyless12345679.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      padding-top: 56px; /* Adjusted for navbar height */
    }
    
    .navbar-nav .nav-link {
      color: white !important;
    }
    
    .content {
      padding: 20px;
      background-color: #7c3aed; /* Purple background color */
    }
    
    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      width: 50px;
      height: auto;
    }
    
    .box {
      background-color: #1c1c1e;
      color: white;
      padding: 20px;
      margin: 10px 0;
      border-radius: 5px;
    }
    
    .title {
      font-size: 1.5rem;
      text-align: center;
    }
    
    .charts-container {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap; /* Allows charts to wrap on smaller screens */
    }
    
    .chart-box {
      flex: 1 1 50%; /* Ensure charts take full width initially */
      margin-bottom: 20px; /* Space between charts */
    }
    
    .chart {
  background-color: #1c1c1e;
  color: white;
  padding: 20px;
  border-radius: 5px;
  height: auto; /* Adjusted to auto for dynamic height based on content */
  width: 100%; /* Ensures charts fill the container width */
  box-sizing: border-box; /* Ensures padding is included in total width */
}
    
    .notification-icon {
      position: fixed;
      top: 70px; /* Adjusted to be below navbar */
      right: 20px; /* Adjusted to top right */
      cursor: pointer;
      width: 40px; /* Set a fixed width */
      height: 40px; /* Set a fixed height */
    }
    
    .notifications-container {
      position: fixed;
      top: 120px; /* Adjusted to be below navbar */
      right: 20px; /* Adjusted to top right */
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      background-color: #333;
      color: white;
      border-radius: 5px;
      display: none;
      padding: 20px;
    }
    
    .notification {
      margin-bottom: 10px;
    }
    
    @media (min-width: 768px) {
      .chart-box {
        flex: 1 1 48%; /* Adjusted for two-column layout on larger screens */
        margin-right: 2%; /* Space between charts */
      }
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href="#">
    <img src="images/picon.png" width="30" height="30" class="d-inline-block align-top" alt="">
    Admin
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="dbadmin.html">Dashboard</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="laf.html">Lost And Found Items</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="claimedadmin.html">Claimed Items</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="index.html">Log Out</a>
      </li>
    </ul>
  </div>
</nav>

<div class="content">
  <div class="content-header">
    <h1>Dashboard</h1>
  </div>
  <div class="container">
    <div class="box">
      <p class="title"><b>Total Lost Items: <span id="total-lost">0</span></b></p>
    </div>
    <div class="box">
      <p class="title"><b>Total Claimed Items: <span id="total-claimed">0</span></b></p>
    </div>
  </div>
  <div class="charts-container">
    <div class="chart-box">
      <div class="chart">
        <h2>Weekly Lost Items</h2>
        <canvas id="lostItemsChart"></canvas>
      </div>
    </div>
    <div class="chart-box">
      <div class="chart">
        <h2>Weekly Claimed Items</h2>
        <canvas id="claimedItemsChart"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="notification-icon" id="notificationIcon">
  <img src="images/notificon.png" alt="Notification Icon" width="40" height="40">
</div>

<div class="notifications-container" id="notificationsContainer">
  <h2>Contact Us Notifications</h2>
  <div id="notifications"></div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
  import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

  const firebaseConfig = {
    apiKey: "AIzaSyDqaFeFgdypMXb8IiOGCoroURcPH0aDk8A",
      authDomain: "seeksmart-database.firebaseapp.com",
      databaseURL: "https://seeksmart-database-default-rtdb.firebaseio.com",
      projectId: "seeksmart-database",
      storageBucket: "seeksmart-database.appspot.com",
      messagingSenderId: "1066553932800",
      appId: "1:1066553932800:web:1c0d9604286191bd5f6ce5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  function updateCounts() {
    const lostItemsRef = ref(db, 'lostItemForm');
    const claimedItemsRef = ref(db, 'claimedItems');

    onValue(lostItemsRef, (snapshot) => {
      const lostCount = snapshot.exists() ? snapshot.size || snapshot.numChildren() : 0;
      document.getElementById('total-lost').textContent = lostCount;
    });

    onValue(claimedItemsRef, (snapshot) => {
      const claimedCount = snapshot.exists() ? snapshot.size || snapshot.numChildren() : 0;
      document.getElementById('total-claimed').textContent = claimedCount;
    });
  }

  function updateNotifications() {
    const contactFormRef = ref(db, 'contactForm');
    const notificationsContainer = document.getElementById('notifications');

    onValue(contactFormRef, (snapshot) => {
      notificationsContainer.innerHTML = '';
      snapshot.forEach((childSnapshot) => {
        const notification = childSnapshot.val();
        const notificationElement = document.createElement('div');
        notificationElement.className = 'notification';
        notificationElement.textContent = `Message from ${notification.firstName} ${notification.lastName}: ${notification.helpMsg}`;
        notificationsContainer.appendChild(notificationElement);
      });
    });
  }

  function toggleNotifications() {
    const notificationsContainer = document.getElementById('notificationsContainer');
    if (window.getComputedStyle(notificationsContainer).display === 'none') {
      notificationsContainer.style.display = 'block';
    } else {
      notificationsContainer.style.display = 'none';
    }
  }

  document.getElementById('notificationIcon').addEventListener('click', toggleNotifications);

  function getWeekNumber(d) {
    d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
    const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
    const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    return [d.getUTCFullYear(), weekNo];
  }

  function updateCharts() {
    const lostItemsRef = ref(db, 'lostItemForm');
    const claimedItemsRef = ref(db, 'claimedItems');

    const lostItemsData = {};
    const claimedItemsData = {};

    onValue(lostItemsRef, (snapshot) => {
      snapshot.forEach((childSnapshot) => {
        const item = childSnapshot.val();
        const date = new Date(item.foundDate);
        const [year, week] = getWeekNumber(date);
        const weekLabel = `Week ${week}, ${year}`;
        if (!lostItemsData[weekLabel]) lostItemsData[weekLabel] = 0;
        lostItemsData[weekLabel]++;
      });

      const labels = Object.keys(lostItemsData).sort();
      const data = labels.map(label => lostItemsData[label]);

      new Chart(document.getElementById('lostItemsChart'), {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Lost Items',
            data: data,
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    });

    onValue(claimedItemsRef, (snapshot) => {
      snapshot.forEach((childSnapshot) => {
        const item = childSnapshot.val();
        const date = new Date(item.claimedDate);
        const [year, week] = getWeekNumber(date);
        const weekLabel = `Week ${week}, ${year}`;
        if (!claimedItemsData[weekLabel]) claimedItemsData[weekLabel] = 0;
        claimedItemsData[weekLabel]++;
      });

      const labels = Object.keys(claimedItemsData).sort();
      const data = labels.map(label => claimedItemsData[label]);

      new Chart(document.getElementById('claimedItemsChart'), {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Claimed Items',
            data: data,
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    });
  }

  window.addEventListener('load', () => {
    updateCounts();
    updateNotifications();
    updateCharts();
  });
</script>

</body>
</html>
